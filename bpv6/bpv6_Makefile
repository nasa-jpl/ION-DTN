BP_SRC_DIR = $(srcdir)/bpv6

# Define pod2man stuff
bpPODM1 = pod2man -s 1 -c "BP executables"
bpPODM3 = pod2man -s 3 -c "BP library functions"
bpPODM5 = pod2man -s 5 -c "BP configuration files"

bpcflags = -I$(BP_SRC_DIR)/library -I$(BP_SRC_DIR)/library/ext -I$(BP_SRC_DIR)/library/ext/meb -I$(BP_SRC_DIR)/library/ext/bae -I$(BP_SRC_DIR)/include -I$(BP_SRC_DIR)/ipn -I$(BP_SRC_DIR)/ipnd -I$(srcdir)/ici/libbloom-master -I$(srcdir)/ici/libbloom-master/murmur2 -I$(BP_SRC_DIR)/dtn2 -I$(BP_SRC_DIR)/library/crypto -I$(BP_SRC_DIR)/imc -I$(BP_SRC_DIR)/tcp -I$(BP_SRC_DIR)/udp -I$(srcdir)/ici/include -I$(BP_SRC_DIR)/library/ext/snw -I$(BP_SRC_DIR)/bibe -I$(BP_SRC_DIR)/imc -DBP_EXTENDED -I$(BP_SRC_DIR)/library/acs -I$(BP_SRC_DIR)/library/ext/ecos -I$(BP_SRC_DIR)/library/ext/sbsp -I$(BP_SRC_DIR)/library/ext/phn -I$(BP_SRC_DIR)/library/ext/sbsp/ciphersuites -I$(BP_SRC_DIR)/library/ext/cteb

bpbin = \
	beacon \
	bibeadmin \
	bibeclo \
	bpadmin \
	bpcancel \
	bpclm \
	bpclock \
	bpcounter \
	bpcrash \
	bpdriver \
	bpecho \
	bping \
	bplist \
	bpnmtest \
	bprecvfile \
	bpsecadmin \
	bpsendfile \
	bpsink \
	bpsource \
	bpstats \
	bptrace \
	bptransit \
	bpversion \
	brsccla \
	brsscla \
	bsspcli \
	bsspclo \
	cgrfetch \
	dgrcli \
	dgrclo \
	dtn2admin \
	dtn2adminep \
	dtn2fw \
	hmackeys \
	ipnadmin \
	ipnadminep \
	ipnd \
	ipnfw \
	lgagent \
	lgsend \
	ltpcli \
	ltpclo \
	bpa \
	stcpcli \
	stcpclo \
	tcpcli \
	tcpclo \
	udpcli \
	udpclo

if !WINDOWS
bpbin += \
	bpstats2 \
	bpchat \
	dccpcli \
	dccpclo
endif

if ENABLE_BPACS
bpbin += \
	acsadmin \
	acslist
endif # end ENABLE_BPACS


if ENABLE_IMC
bpbin += \
	imcadmin \
	imcfw
endif # end ENABLE_IMC

bplib = \
	libbp.la \
	libcgr.la \
	libstcpcla.la \
	libudpcla.la

bpinclude = \
	bpv6/include/bp.h \
	bpv6/include/eureka.h


#ecos.h goes here?
#bp/library/ecos.h
bpnoinst = \
	bpv6/library/bpP.h \
	bpv6/include/bpsec.h \
	bpv6/ipn/ipnfw.h \
	bpv6/ipnd/ipndP.h \
	bpv6/dtn2/dtn2fw.h \
	bpv6/brs/brscla.h \
	bpv6/udp/udpcla.h \
	bpv6/ltp/ltpcla.h \
	bpv6/stcp/stcpcla.h \
	bpv6/dccp/dccpcla.h \
	bpv6/library/saga.h

bpextra = \
	bpv6/README.txt \
	bpv6/doc/pod1/bibeclo.pod \
	bpv6/doc/pod1/bpadmin.pod \
	bpv6/doc/pod1/bpcancel.pod \
	bpv6/doc/pod1/bpchat.pod \
	bpv6/doc/pod1/bpclm.pod \
	bpv6/doc/pod1/bpclock.pod \
	bpv6/doc/pod1/bpcounter.pod \
	bpv6/doc/pod1/bpdriver.pod \
	bpv6/doc/pod1/bpecho.pod \
	bpv6/doc/pod1/bping.pod \
	bpv6/doc/pod1/bplist.pod \
	bpv6/doc/pod1/bpnmtest.pod \
	bpv6/doc/pod1/bprecvfile.pod \
	bpv6/doc/pod1/bpsecadmin.pod \
	bpv6/doc/pod1/bpsendfile.pod \
	bpv6/doc/pod1/bpsink.pod \
	bpv6/doc/pod1/bpsource.pod \
	bpv6/doc/pod1/bpstats.pod \
	bpv6/doc/pod1/bpstats2.pod \
	bpv6/doc/pod1/bptrace.pod \
	bpv6/doc/pod1/bptransit.pod \
	bpv6/doc/pod1/brsccla.pod \
	bpv6/doc/pod1/brsscla.pod \
	bpv6/doc/pod1/cgrfetch.pod \
	bpv6/doc/pod1/dccpcli.pod \
	bpv6/doc/pod1/dccpclo.pod \
	bpv6/doc/pod1/dgrcli.pod \
	bpv6/doc/pod1/dgrclo.pod \
	bpv6/doc/pod1/dtn2admin.pod \
	bpv6/doc/pod1/dtn2adminep.pod \
	bpv6/doc/pod1/dtn2fw.pod \
	bpv6/doc/pod1/hmackeys.pod \
	bpv6/doc/pod1/ipnadmin.pod \
	bpv6/doc/pod1/ipnadminep.pod \
	bpv6/doc/pod1/ipnd.pod \
	bpv6/doc/pod1/ipnfw.pod \
	bpv6/doc/pod1/lgagent.pod \
	bpv6/doc/pod1/lgsend.pod \
	bpv6/doc/pod1/ltpcli.pod \
	bpv6/doc/pod1/ltpclo.pod \
	bpv6/doc/pod1/stcpcli.pod \
	bpv6/doc/pod1/stcpclo.pod \
	bpv6/doc/pod1/tcpcli.pod \
	bpv6/doc/pod1/tcpclo.pod \
	bpv6/doc/pod1/udpcli.pod \
	bpv6/doc/pod1/udpclo.pod \
	bpv6/doc/pod3/bp.pod \
	bpv6/doc/pod3/bpextensions.pod \
	bpv6/doc/pod5/bprc.pod \
	bpv6/doc/pod5/bpsecrc.pod \
	bpv6/doc/pod5/dtn2rc.pod \
	bpv6/doc/pod5/ipnrc.pod \
	bpv6/doc/pod5/lgfile.pod \
	bpv6/bibe/bibe.h \
	bpv6/include/bpsec.h \
	bpv6/library/bpextensions.c \
	bpv6/library/noextensions.c \
	bpv6/library/ext/ecos/ecos.h \
	bpv6/library/ext/ecos/ecos.c \
	bpv6/library/ext/meb \
	bpv6/library/ext/meb/meb.h \
	bpv6/library/ext/meb/meb.c \
	bpv6/library/bei.c \
	bpv6/library/bpsec.c \
	bpv6/library/saga.h \
	bpv6/library/saga.c \
	bpv6/library/ext/bae/bae.h \
	bpv6/library/ext/bae/bae.c \
	ici/include/crypto.h \
	ici/include/csi.h \
	bpv6/library/ext/sbsp/sbsp_instr.h \
	bpv6/library/ext/sbsp/sbsp_instr.c \
	bpv6/library/ext/sbsp/sbsp_bcb.h \
	bpv6/library/ext/sbsp/sbsp_bcb.c \
	bpv6/library/ext/sbsp/sbsp_bib.h \
	bpv6/library/ext/sbsp/sbsp_bib.c \
	bpv6/library/ext/sbsp/sbsp_util.h \
	bpv6/library/ext/sbsp/sbsp_util.c \
	bpv6/library/ext/sbsp/profiles.h \
	bpv6/library/ext/sbsp/profiles.c

if ENABLE_IMC
bpextra += \
	bpv6/doc/pod1/imcadmin.pod \
	bpv6/doc/pod1/imcfw.pod \
	bpv6/doc/pod5/imcrc.pod
endif # end ENABLE_IMC


# noextensions.c is C code, but it isn't explicitly compiled.
# instead, the whole file is #included into libbpP.c
# For this reason, it is extra_DIST.
# ecos and myextensions are optional and it is unclear if they must be
# installed in the normal case- so we shall leave them extra_DIST for now.

bpmans = \
	$(top_builddir)/bpv6/doc/bibeclo.1 \
	$(top_builddir)/bpv6/doc/bpadmin.1 \
	$(top_builddir)/bpv6/doc/bpcancel.1 \
	$(top_builddir)/bpv6/doc/bpchat.1 \
	$(top_builddir)/bpv6/doc/bpclm.1 \
	$(top_builddir)/bpv6/doc/bpclock.1 \
	$(top_builddir)/bpv6/doc/bpcounter.1 \
	$(top_builddir)/bpv6/doc/bpdriver.1 \
	$(top_builddir)/bpv6/doc/bpecho.1 \
	$(top_builddir)/bpv6/doc/bping.1 \
	$(top_builddir)/bpv6/doc/bplist.1 \
	$(top_builddir)/bpv6/doc/bpnmtest.1 \
	$(top_builddir)/bpv6/doc/bprecvfile.1 \
	$(top_builddir)/bpv6/doc/bpsecadmin.1 \
	$(top_builddir)/bpv6/doc/bpsendfile.1 \
	$(top_builddir)/bpv6/doc/bpsink.1 \
	$(top_builddir)/bpv6/doc/bpsource.1 \
	$(top_builddir)/bpv6/doc/bpstats.1 \
	$(top_builddir)/bpv6/doc/bpstats2.1 \
	$(top_builddir)/bpv6/doc/bptrace.1 \
	$(top_builddir)/bpv6/doc/bptransit.1 \
	$(top_builddir)/bpv6/doc/brsccla.1 \
	$(top_builddir)/bpv6/doc/brsscla.1 \
	$(top_builddir)/bpv6/doc/cgrfetch.1 \
	$(top_builddir)/bpv6/doc/dccpcli.1 \
	$(top_builddir)/bpv6/doc/dccpclo.1 \
	$(top_builddir)/bpv6/doc/dgrcli.1 \
	$(top_builddir)/bpv6/doc/dgrclo.1 \
	$(top_builddir)/bpv6/doc/dtn2admin.1 \
	$(top_builddir)/bpv6/doc/dtn2adminep.1 \
	$(top_builddir)/bpv6/doc/dtn2fw.1 \
	$(top_builddir)/bpv6/doc/hmackeys.1 \
	$(top_builddir)/bpv6/doc/ipnadmin.1 \
	$(top_builddir)/bpv6/doc/ipnadminep.1 \
	$(top_builddir)/bpv6/doc/ipnd.1 \
	$(top_builddir)/bpv6/doc/ipnfw.1 \
	$(top_builddir)/bpv6/doc/lgagent.1 \
	$(top_builddir)/bpv6/doc/lgsend.1 \
	$(top_builddir)/bpv6/doc/ltpcli.1 \
	$(top_builddir)/bpv6/doc/ltpclo.1 \
	$(top_builddir)/bpv6/doc/stcpcli.1 \
	$(top_builddir)/bpv6/doc/stcpclo.1 \
	$(top_builddir)/bpv6/doc/tcpcli.1 \
	$(top_builddir)/bpv6/doc/tcpclo.1 \
	$(top_builddir)/bpv6/doc/udpcli.1 \
	$(top_builddir)/bpv6/doc/udpclo.1 \
	$(top_builddir)/bpv6/doc/bp.3 \
	$(top_builddir)/bpv6/doc/bpextensions.3 \
	$(top_builddir)/bpv6/doc/bprc.5 \
	$(top_builddir)/bpv6/doc/bpsecrc.5 \
	$(top_builddir)/bpv6/doc/dtn2rc.5 \
	$(top_builddir)/bpv6/doc/ipnrc.5 \
	$(top_builddir)/bpv6/doc/lgfile.5

# ACS only exists in BPv6 so only build the docs if BPv6 and ACS is enabled
if ENABLE_BPACS
bpmans += \
	$(top_builddir)/bpv6/doc/acsadmin.1 \
	$(top_builddir)/bpv6/doc/acslist.1 \
	$(top_builddir)/bpv6/doc/acsrc.5
endif # end ENABLE_BPACS


if ENABLE_IMC
bpmans += \
	$(top_builddir)/bpv6/doc/imcadmin.1 \
	$(top_builddir)/bpv6/doc/imcfw.1 \
	$(top_builddir)/bpv6/doc/imcrc.5
endif # end ENABLE_IMC


bpclean-local:
	rm -f $(top_builddir)/bpv6/doc/*.1
	rm -f $(top_builddir)/bpv6/doc/*.3
	rm -f $(top_builddir)/bpv6/doc/*.5

$(top_builddir)/bpv6/doc/%.1: bpv6/doc/pod1/%.pod
	$(bpPODM1) $< $@

$(top_builddir)/bpv6/doc/%.3: bpv6/doc/pod3/%.pod
	$(bpPODM3) $< $@

$(top_builddir)/bpv6/doc/%.5: bpv6/doc/pod5/%.pod
	$(bpPODM5) $< $@

# -- Libraries --- #

libstcpcla_la_SOURCES = bpv6/stcp/libstcpcla.c
libstcpcla_la_CFLAGS = $(bpcflags) $(AM_CFLAGS)
libstcpcla_la_LIBADD = libbp.la libici.la

libudpcla_la_SOURCES = bpv6/udp/libudpcla.c
libudpcla_la_CFLAGS = $(bpcflags) $(AM_CFLAGS)
libudpcla_la_LIBADD = libbp.la libici.la


libbp_la_SOURCES = \
	bpv6/bibe/bibe.c \
	bpv6/dtn2/libdtn2fw.c \
	bpv6/ipn/libipnfw.c \
	bpv6/ipnd/ipnd.c \
	bpv6/ipnd/beacon.c \
	bpv6/ipnd/helper.c \
	bpv6/ipnd/bpa.c \
	bpv6/library/acs/acs.h \
	bpv6/library/bei.c \
	bpv6/library/bpsec.c \
	bpv6/library/eureka.c \
	bpv6/library/libbp.c \
	bpv6/library/libbpP.c \
	bpv6/library/libbpnm.c \
	bpv6/library/saga.c \
	bpv6/library/ext/bae/bae.c \
	bpv6/library/ext/ecos/ecos.c \
	bpv6/library/ext/meb/meb.c \
	bpv6/library/ext/phn/phn.c \
	bpv6/library/ext/sbsp/sbsp_instr.c \
	bpv6/library/ext/sbsp/sbsp_bcb.c \
	bpv6/library/ext/sbsp/sbsp_bib.c \
	bpv6/library/ext/sbsp/sbsp_util.c \
	bpv6/library/ext/sbsp/profiles.c \
	bpv6/library/ext/snid/snid.c \
	bpv6/library/ext/snw/snw.c \
	ici/libbloom-master/bloom.h \
	ici/libbloom-master/bloom.c \
	ici/libbloom-master/murmur2/MurmurHash2.c


if CRYPTO
libici_la_SOURCES+= \
	ici/crypto/NULL_SUITES/crypto.c\
	ici/crypto/NULL_SUITES/csi.c
else
libici_la_SOURCES+= \
	ici/crypto/NULL_SUITES/crypto.c\
	ici/crypto/NULL_SUITES/csi.c
endif # end CRYPTO

libbp_la_CFLAGS = $(bpcflags) $(AM_CFLAGS) -I$(BP_SRC_DIR)/library/ext -I$(BP_SRC_DIR)
libbp_la_LIBADD = libici.la -lm $(CRYPTO_LIBS)

#libbp_la_LIBADD = libici.la libipnfw.la libdtn2fw.la $(CRYPTO_LIBS) -lm
#EJB
if ENABLE_BPACS
libbp_la_SOURCES += \
	bpv6/library/acs/acsrx.c \
	bpv6/library/acs/acstx.c \
	bpv6/library/acs/acsserialize.c \
	bpv6/library/acs/acsappend.c \
	bpv6/library/acs/acsid.c \
	bpv6/library/ext/cteb/cteb.c \
	$(NULL)
endif # end ENABLE_BPACS

if ENABLE_IMC
libbp_la_SOURCES += \
	bpv6/imc/libimcfw.c \
	$(NULL)
endif # end ENABLE_IMC

libcgr_la_SOURCES = bpv6/cgr/libcgr.c
libcgr_la_CFLAGS = $(bpcflags) $(AM_CFLAGS)
libcgr_la_LIBADD = libbp.la libici.la

# --- Utility Programs --- #

bpadmin_SOURCES = bpv6/utils/bpadmin.c
bpadmin_LDADD = libbp.la libici.la $(LIBOBJS)
bpadmin_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpsecadmin_SOURCES = bpv6/utils/bpsecadmin.c
bpsecadmin_LDADD = libbp.la libici.la $(LIBOBJS)
bpsecadmin_CFLAGS = $(bpcflags) $(AM_CFLAGS)

ipnadmin_SOURCES = bpv6/ipn/ipnadmin.c
ipnadmin_LDADD = libbp.la libici.la $(LIBOBJS)
ipnadmin_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# Only try to build ACS if BPv6 and ACS is enabled
if ENABLE_BPACS
acsadmin_SOURCES = bpv6/utils/acsadmin.c
acsadmin_LDADD = libbp.la libici.la $(LIBOBJS)
acsadmin_CFLAGS = $(bpcflags) $(AM_CFLAGS)

acslist_SOURCES = bpv6/utils/acslist.c
acslist_LDADD = libbp.la libici.la $(LIBOBJS)
acslist_CFLAGS = $(bpcflags) $(AM_CFLAGS)
endif # end ENABLE_BPACS

if ENABLE_IMC
imcadmin_SOURCES = bpv6/imc/imcadmin.c
imcadmin_LDADD = libbp.la libici.la $(LIBOBJS)
imcadmin_CFLAGS = $(bpcflags) $(AM_CFLAGS)

imcfw_SOURCES = bpv6/imc/imcfw.c
imcfw_LDADD = libbp.la libici.la $(LIBOBJS)
imcfw_CFLAGS = $(bpcflags) $(AM_CFLAGS)
endif # end ENABLE_IMC

dtn2admin_SOURCES = bpv6/dtn2/dtn2admin.c
dtn2admin_LDADD = libbp.la libici.la $(LIBOBJS)
dtn2admin_CFLAGS = $(bpcflags) $(AM_CFLAGS)

lgsend_SOURCES = bpv6/utils/lgsend.c
lgsend_LDADD = libbp.la libici.la $(LIBOBJS)
lgsend_CFLAGS = $(bpcflags) $(AM_CFLAGS)

lgagent_SOURCES = bpv6/utils/lgagent.c
lgagent_LDADD = libbp.la libici.la $(LIBOBJS)
lgagent_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpstats_SOURCES = bpv6/utils/bpstats.c
bpstats_LDADD = libbp.la libici.la $(LIBOBJS)
bpstats_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bptrace_SOURCES = bpv6/utils/bptrace.c
bptrace_LDADD = libbp.la libici.la $(LIBOBJS)
bptrace_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpcancel_SOURCES = bpv6/utils/bpcancel.c
bpcancel_LDADD = libbp.la libici.la $(LIBOBJS)
bpcancel_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpversion_SOURCES = bpv6/utils/bpversion.c
bpversion_LDADD = libbp.la libici.la $(LIBOBJS)
bpversion_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bplist_SOURCES = bpv6/utils/bplist.c
bplist_LDADD = libbp.la libici.la $(LIBOBJS)
bplist_CFLAGS = $(bpcflags) $(AM_CFLAGS)

hmackeys_SOURCES = bpv6/utils/hmackeys.c
hmackeys_LDADD = libici.la -lm libbp.la $(LIBOBJS)
hmackeys_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- DTN Executables --- #

dtn2fw_SOURCES = bpv6/dtn2/dtn2fw.c
dtn2fw_LDADD = libbp.la libici.la $(LIBOBJS)
dtn2fw_CFLAGS = $(bpcflags) $(AM_CFLAGS)

dtn2adminep_SOURCES = bpv6/dtn2/dtn2adminep.c
dtn2adminep_LDADD = libbp.la libici.la $(LIBOBJS)
dtn2adminep_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- IPN Executables --- #

ipnfw_SOURCES = bpv6/ipn/ipnfw.c
ipnfw_LDADD = libcgr.la libbp.la libici.la $(LIBOBJS)
ipnfw_CFLAGS = $(bpcflags) $(AM_CFLAGS)

ipnadminep_SOURCES = bpv6/ipn/ipnadminep.c
ipnadminep_LDADD = libbp.la libici.la $(LIBOBJS)
ipnadminep_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- IPND Executables --- #

#helper_SOURCES = bpv6/ipnd/helper.c
#helper_LDADD = libbp.la libipnfw.la  libdtn2fw.la libici.la $(LIBOBJS)
#helper_CFLAGS = $(bpcflags) $(AM_CFLAGS)

ipnd_SOURCES = bpv6/ipnd/ipnd.c
ipnd_LDADD = libcgr.la libbp.la libici.la $(LIBOBJS)
ipnd_CFLAGS = $(bpcflags) $(AM_CFLAGS)

beacon_SOURCES = bpv6/ipnd/beacon.c
beacon_LDADD = libbp.la libici.la $(LIBOBJS)
beacon_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpa_SOURCES = bpv6/ipnd/bpa.c
bpa_LDADD = libbp.la libici.la $(LIBOBJS)
bpa_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- BSSP Executables --- #

bsspcli_SOURCES = bpv6/bssp/bsspcli.c
bsspcli_LDADD = libbssp.la libbp.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
bsspcli_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bsspclo_SOURCES = bpv6/bssp/bsspclo.c
bsspclo_LDADD = libbssp.la libbp.la libici.la $(LIBOBJS)
bsspclo_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- LTP Executables --- #

ltpcli_SOURCES = bpv6/ltp/ltpcli.c
ltpcli_LDADD = libbp.la libltp.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
ltpcli_CFLAGS = $(bpcflags) $(AM_CFLAGS)

ltpclo_SOURCES = bpv6/ltp/ltpclo.c
ltpclo_LDADD = libbp.la libltp.la libici.la $(LIBOBJS)
ltpclo_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- TCP Executables --- #

tcpcli_SOURCES = bpv6/tcp/tcpcli.c
tcpcli_LDADD = libbp.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
tcpcli_CFLAGS = $(bpcflags) $(AM_CFLAGS)

tcpclo_SOURCES = bpv6/tcp/tcpclo.c
tcpclo_LDADD = libbp.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
tcpclo_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- STCP Executables --- #

stcpcli_SOURCES = bpv6/stcp/stcpcli.c
stcpcli_LDADD = libbp.la libici.la libstcpcla.la $(LIBOBJS) $(PTHREAD_LIBS)
stcpcli_CFLAGS = $(bpcflags) $(AM_CFLAGS)

stcpclo_SOURCES = bpv6/stcp/stcpclo.c
stcpclo_LDADD = libbp.la libici.la libstcpcla.la $(LIBOBJS) $(PTHREAD_LIBS)
stcpclo_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- UDP Executables --- #

udpcli_SOURCES = bpv6/udp/udpcli.c
udpcli_LDADD = libbp.la libudpcla.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
udpcli_CFLAGS = $(bpcflags) $(AM_CFLAGS)

udpclo_SOURCES = bpv6/udp/udpclo.c
udpclo_LDADD = libbp.la libudpcla.la libici.la $(LIBOBJS)
udpclo_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- BIBE Executables --- #

bibeclo_SOURCES = bpv6/bibe/bibeclo.c
bibeclo_LDADD = libbp.la libudpcla.la libici.la $(LIBOBJS)
bibeclo_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bibeadmin_SOURCES = bpv6/bibe/bibeadmin.c
bibeadmin_LDADD = libbp.la libici.la $(LIBOBJS)
bibeadmin_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- DCCP Executables --- #

dccpcli_SOURCES = bpv6/dccp/dccpcli.c
dccpcli_LDADD = libbp.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
dccpcli_CFLAGS = $(bpcflags) $(AM_CFLAGS)

dccpclo_SOURCES = bpv6/dccp/dccpclo.c
dccpclo_LDADD = libbp.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
dccpclo_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- DGR Executables --- #

dgrcli_SOURCES = bpv6/dgr/dgrcli.c
dgrcli_LDADD = libbp.la libdgr.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
dgrcli_CFLAGS = $(bpcflags) $(AM_CFLAGS)

dgrclo_SOURCES = bpv6/dgr/dgrclo.c
dgrclo_LDADD = libbp.la libdgr.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
dgrclo_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- BRS executables --- #

brsscla_SOURCES = bpv6/brs/brsscla.c
brsscla_LDADD = libbp.la libici.la libstcpcla.la $(LIBOBJS) $(PTHREAD_LIBS)
brsscla_CFLAGS = $(bpcflags) $(AM_CFLAGS)

brsccla_SOURCES = bpv6/brs/brsccla.c
brsccla_LDADD = libbp.la libici.la libstcpcla.la $(LIBOBJS) $(PTHREAD_LIBS)
brsccla_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- Test Executables --- #

bpsource_SOURCES = bpv6/test/bpsource.c
bpsource_LDADD = libbp.la libici.la $(LIBOBJS)
bpsource_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpsink_SOURCES = bpv6/test/bpsink.c
bpsink_LDADD = libbp.la libici.la $(LIBOBJS)
bpsink_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpdriver_SOURCES = bpv6/test/bpdriver.c
bpdriver_LDADD = libbp.la libici.la $(LIBOBJS)
bpdriver_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpecho_SOURCES = bpv6/test/bpecho.c
bpecho_LDADD = libbp.la libici.la $(LIBOBJS)
bpecho_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpcounter_SOURCES = bpv6/test/bpcounter.c
bpcounter_LDADD = libbp.la libici.la $(LIBOBJS)
bpcounter_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpsendfile_SOURCES = bpv6/utils/bpsendfile.c
bpsendfile_LDADD = libbp.la libici.la $(LIBOBJS)
bpsendfile_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bprecvfile_SOURCES = bpv6/utils/bprecvfile.c
bprecvfile_LDADD = libbp.la libici.la $(LIBOBJS)
bprecvfile_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bping_SOURCES = bpv6/test/bping.c
bping_LDADD = libbp.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
bping_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpnmtest_SOURCES = bpv6/test/bpnmtest.c
bpnmtest_LDADD = libbp.la libici.la $(LIBOBJS)
bpnmtest_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpcrash_SOURCES = bpv6/test/bpcrash.c
bpcrash_LDADD = libbp.la libici.la $(LIBOBJS)
bpcrash_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpstats2_SOURCES = bpv6/test/bpstats2.c
bpstats2_LDADD = libbp.la libici.la $(LIBOBJS)
bpstats2_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpchat_SOURCES = bpv6/test/bpchat.c
bpchat_LDADD = libbp.la libici.la $(LIBOBJS) $(PTHREAD_LIBS)
bpchat_CFLAGS = $(bpcflags) $(AM_CFLAGS)

cgrfetch_SOURCES = bpv6/utils/cgrfetch.c
cgrfetch_LDADD = libbp.la libici.la libcgr.la $(LIBOBJS)
cgrfetch_CFLAGS = $(bpcflags) $(AM_CFLAGS)

# --- Daemon Executables --- #

bpclock_SOURCES = bpv6/daemon/bpclock.c
bpclock_LDADD = libbp.la libici.la $(LIBOBJS)
bpclock_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bptransit_SOURCES = bpv6/daemon/bptransit.c
bptransit_LDADD = libbp.la libici.la $(LIBOBJS)
bptransit_CFLAGS = $(bpcflags) $(AM_CFLAGS)

bpclm_SOURCES = bpv6/daemon/bpclm.c
bpclm_LDADD = libbp.la libici.la $(LIBOBJS)
bpclm_CFLAGS = $(bpcflags) $(AM_CFLAGS)

############################
#
# NETWORK MANAGEMENT SECTION
#                                        
############################

nmbin= nm_agent nm_mgr
nmlib= libamp.la libampAgentADM.la

nmPODM1 = pod2man -s 1 -c "NM executables"
nmPODM3 = pod2man -s 1 -c "NM libraries"

# CBOR Library Sources
nm_cbor_src = \
	nm/contrib/QCBOR/src/UsefulBuf.c \
	nm/contrib/QCBOR/src/qcbor_encode.c \
	nm/contrib/QCBOR/src/qcbor_decode.c \
	nm/contrib/QCBOR/src/ieee754.c

AMP_VERSION ?= 8
#$(warning "AMP_VERSION is ${AMP_VERSION}")
NM_CBOR_CFLAGS = -I $(srcdir)/nm/contrib/QCBOR/inc -DAMP_VERSION=${AMP_VERSION}

# NM Shared library
#  This library is standalone (no dependencies on other ION components)
nm_shared_src =	\
	nm/shared/adm/adm.c \
	nm/shared/msg/msg.c \
	nm/shared/primitives/ari.c \
	nm/shared/primitives/blob.c \
	nm/shared/primitives/ctrl.c \
	nm/shared/primitives/edd_var.c \
	nm/shared/primitives/expr.c \
	nm/shared/primitives/report.c \
	nm/shared/primitives/rules.c \
	nm/shared/primitives/table.c \
	nm/shared/primitives/tnv.c \
	nm/shared/utils/cbor_utils.c \
	nm/shared/utils/db.c \
	nm/shared/utils/nm_types.c \
	nm/shared/utils/rhht.c \
	nm/shared/utils/utils.c \
	nm/shared/utils/vector.c \
	$(nm_cbor_src)

libamp_la_SOURCES = $(nm_shared_src)
libamp_la_CFLAGS = -I/usr/include -I$(srcdir)/ici/library -I$(srcdir)/bpv6/library -I$(srcdir)/ltp/library -I$(srcdir)/nm  \
                  -I$(srcdir)/nm/agent -I$(srcdir)/bpv6/library/ext/sbsp $(AM_CFLAGS) $(NO_UNUSED_VARIABLE) \
                  $(NM_CBOR_CFLAGS)
# Note: ici reference is used here only for memory management.  If -DUSE_MALLOC is used for NM (not recommended), this dependency would be unneeded.
libamp_la_LIBADD = libici.la

# Note: AMP Agent ADM must be built directly with the agent, whereas all other ADMs can be modularized as needed.
nm_agent_SOURCES = \
	nm/agent/ingest.c \
	nm/agent/instr.c \
	nm/agent/lcc.c \
	nm/agent/nmagent.c \
	nm/agent/ldc.c \
	nm/agent/rda.c \
	nm/shared/msg/ion_if.c \
	nm/agent/adm_amp_agent_impl.c \
	nm/agent/adm_amp_agent_agent.c \
	nm/shared/adm/adm_init.c

NM_ADM_INCLUDES = -I$(srcdir)/nm/shared/adm -I$(BP_SRC_DIR)/adm -I$(BP_SRC_DIR)

nm_agent_ADM_SOURCES = \
	bpv6/adm/adm_bp_agent_impl.c \
	bpv6/adm/adm_bp_agent_agent.c \
	bpv6/adm/adm_ion_bp_admin_impl.c \
	bpv6/adm/adm_ion_bp_admin_agent.c \
	bpv6/adm/adm_sbsp_impl.c \
	bpv6/adm/adm_sbsp_agent.c \
	nm/agent/adm_ion_admin_agent.c \
	nm/agent/adm_ion_admin_impl.c \
	nm/agent/adm_ionsec_admin_impl.c \
	nm/agent/adm_ionsec_admin_agent.c \
	nm/agent/adm_ion_ipn_admin_impl.c \
	nm/agent/adm_ion_ipn_admin_agent.c \
	nm/agent/adm_ion_ltp_admin_impl.c \
	nm/agent/adm_ion_ltp_admin_agent.c \
	nm/agent/adm_ltp_agent_impl.c \
	nm/agent/adm_ltp_agent_agent.c



nm_mgr_ADM_SOURCES = \
	bpv6/adm/adm_bp_agent_mgr.c \
	bpv6/adm/adm_ion_bp_admin_mgr.c \
	bpv6/adm/adm_sbsp_mgr.c \
	nm/mgr/adm_amp_agent_mgr.c \
	nm/mgr/adm_ion_admin_mgr.c \
	nm/mgr/adm_ionsec_admin_mgr.c \
	nm/mgr/adm_ion_ipn_admin_mgr.c \
	nm/mgr/adm_ion_ltp_admin_mgr.c \
	nm/mgr/adm_ltp_agent_mgr.c



nmextra = \
	nm/doc/pod1/nm_agent.pod \
	nm/doc/pod1/nm_mgr.pod

nmmans = \
	$(top_builddir)/nm/doc/nm_agent.1 \
	$(top_builddir)/nm/doc/nm_mgr.1

libampAgentADM_la_SOURCES = $(nm_agent_ADM_SOURCES)
libampAgentADM_la_CFLAGS = -I/usr/include -I$(srcdir)/nm -I$(srcdir)/nm/shared/adm -I$(BP_SRC_DIR)/library/ext/sbsp -I$(BP_SRC_DIR) -I$(BP_SRC_DIR)/library -I$(srcdir)/ltp/library $(NM_CBOR_CFLAGS) $(AM_CFLAGS) $(NO_UNUSED_VARIABLE) 
libampAgentADM_la_LIBADD = libamp.la libici.la libbp.la libltp.la


nm_agent_LDADD = libici.la libbp.la libltp.la libamp.la libampAgentADM.la $(LIBOBJS) $(PTHREAD_LIBS)
nm_agent_LDFLAGS = -L/usr/local/lib -lm -lpthread 

nm_agent_CFLAGS = -I/usr/include -I$(srcdir)/ici/library -I$(srcdir)/bpv6/library -I$(srcdir)/nm \
                  -I$(srcdir)/nm/agent -I$(srcdir)/nm/shared/adm $(AM_CFLAGS) $(NO_UNUSED_VARIABLE) \
                  -DAGENT_ROLE $(NM_CBOR_CFLAGS) $(NM_ADM_INCLUDES)


nm_mgr_SOURCES = \
	nm/mgr/agents.c \
	nm/mgr/metadata.c \
	nm/mgr/nm_mgr_print.c \
	nm/mgr/nm_mgr_rx.c \
	nm/mgr/nm_mgr_sql.c \
	nm/mgr/nm_mgr_ui.c \
	nm/mgr/nm_mgr.c \
	nm/mgr/ui_input.c \
	$(nm_mgr_ADM_SOURCES) \
	nm/shared/msg/ion_if.c \
	nm/shared/adm/adm_init.c

# TODO: Split cJSON as a seperate configurable supporting library
CIVETWEB_SOURCES = \
	nm/contrib/civetweb/src/civetweb.c \
	nm/contrib/civetweb/examples/rest/cJSON/cJSON.c \
	nm/contrib/civetweb/examples/rest/cJSON/cJSON_Utils.c \
	nm/mgr/nm_rest.c
CIVETWEB_INCLUDES = -I$(srcdir)/nm/contrib/civetweb/include -I$(srcdir)/nm/contrib/civetweb/examples/rest/cJSON
CIVETWEB_LDFLAGS = -ldl
CIVETWEB_CFLAGS = -DNO_SSL -DUSE_CIVETWEB -DUSE_JSON

nm_mgr_LDADD = libamp.la libici.la libbp.la libltp.la $(LIBOBJS) $(PTHREAD_LIBS)

# Note: NCURSES and MySql support are optional and controlled at configure time with --with-mysql or --with-ncurses
nm_mgr_LDFLAGS = -L/usr/local/mysql/lib -lpthread ${MYSQL_LIBS} ${NCURSES_LIBS}
nm_mgr_CFLAGS = -I/usr/local/mysql/include -I$(srcdir)/ici/library -I$(srcdir)/bpv6/library -I$(srcdir)/bpv6/library/ext/sbsp -I$(srcdir)/ltp/library -I$(srcdir)/nm  -I$(srcdir)/nm/mgr -I/usr/include/mysql $(AM_CFLAGS) $(NO_UNUSED_VARIABLE) $(NM_CBOR_CFLAGS) $(NM_ADM_INCLUDES)

if BUILD_NM_REST
nm_mgr_LDFLAGS += $(CIVETWEB_LDFLAGS)
nm_mgr_CFLAGS += $(CIVETWEB_INCLUDES) $(CIVETWEB_CFLAGS)
nm_mgr_SOURCES += $(CIVETWEB_SOURCES)

endif

$(top_builddir)/nm/doc/%.1: nm/doc/pod1/%.pod
	$(nmPODM1) $< $@

$(top_builddir)/nm/doc/%.3: nm/doc/pod3/%.pod
	$(nmPODM3) $< $@
